# DaiSpan ESP32 Web 服務器功能測試計劃

## 🎯 測試概覽

本測試計劃用於驗證 DaiSpan ESP32-C3 智能恆溫器的 Web 服務器功能，包括記憶體優化、頁面生成統一化等新功能。

## ✅ 固件部署狀態

**編譯狀態**: ✅ 成功
- **RAM 使用**: 49.2% (161,252 / 327,680 bytes)
- **Flash 使用**: 81.7% (1,659,840 / 2,031,616 bytes)
- **目標設備**: ESP32-C3 (QFN32) v0.4

**上傳狀態**: ✅ 成功
- **設備 MAC**: fc:01:2c:63:0b:bc
- **上傳端口**: /dev/cu.usbmodem1101
- **固件大小**: 1.78MB

## 🧪 測試步驟

### 階段 1: 設備連接測試

1. **確認設備啟動**
   - 等待設備啟動 (30-60 秒)
   - 檢查設備 LED 狀態
   - 確認串口輸出正常

2. **網路連接確認**
   - **選項 A**: 如果設備已配置 WiFi
     - 在路由器管理頁面查找 "DaiSpan-Thermostat" 設備
     - 記錄設備 IP 地址
   - **選項 B**: 如果設備未配置 WiFi
     - 掃描 WiFi 熱點，尋找 "DaiSpan-Config"
     - 連接到該熱點

### 階段 2: Web 服務器基本功能測試

#### 2.1 主頁面測試 (`/`)
- [ ] **存取主頁**: `http://[設備IP]/`
- [ ] **驗證頁面載入**: 確認頁面正常顯示
- [ ] **檢查記憶體優化**: 頁面應快速載入，無明顯延遲
- [ ] **響應式設計**: 在不同螢幕尺寸下測試
- [ ] **中文顯示**: 確認中文字符正確顯示

**期望結果**:
```
✅ 頁面標題: "DaiSpan 智能恆溫器"
✅ 顯示系統狀態資訊
✅ 記憶體壓力指示器
✅ 溫度和模式控制
✅ 導航連結正常
```

#### 2.2 WiFi 配置頁面測試 (`/wifi`)
- [ ] **存取 WiFi 頁面**: `http://[設備IP]/wifi`
- [ ] **記憶體壓力檢查**: 高壓力時顯示錯誤頁面
- [ ] **表單功能**: SSID 和密碼輸入框
- [ ] **網路掃描**: 點擊掃描按鈕測試
- [ ] **配置保存**: 測試 WiFi 設定保存

**期望結果**:
```
✅ 使用 StreamingResponseBuilder 生成
✅ 統一的記憶體壓力檢查
✅ 優雅的錯誤處理
✅ 表單提交正常工作
```

#### 2.3 HomeKit 配置頁面測試 (`/homekit`)
- [ ] **存取 HomeKit 頁面**: `http://[設備IP]/homekit`
- [ ] **配置表單**: 配對代碼、設備名稱、QR ID
- [ ] **當前設定顯示**: 顯示現有配置值
- [ ] **狀態指示器**: HomeKit 服務狀態
- [ ] **配置更新**: 測試設定保存

**期望結果**:
```
✅ 使用記憶體優化版本
✅ 表單預填入當前值
✅ 服務狀態正確顯示
✅ 更新成功頁面正常
```

### 階段 3: 進階功能測試

#### 3.1 系統狀態與 API 測試
- [ ] **狀態頁面**: `http://[設備IP]/status` (如果存在)
- [ ] **健康檢查 API**: `http://[設備IP]/api/health`
- [ ] **記憶體統計 API**: `http://[設備IP]/api/memory/stats`
- [ ] **系統指標 API**: `http://[設備IP]/api/metrics`

#### 3.2 模擬模式測試 (如果啟用)
- [ ] **模擬控制頁面**: `http://[設備IP]/simulation`
- [ ] **模式切換頁面**: `http://[設備IP]/simulation-toggle`
- [ ] **控制功能**: 溫度、模式、風速調整
- [ ] **狀態更新**: 即時狀態反映

#### 3.3 OTA 更新功能測試
- [ ] **OTA 頁面**: `http://[設備IP]/ota`
- [ ] **更新指示**: 顯示 OTA 服務狀態
- [ ] **使用說明**: PlatformIO 和 Arduino IDE 指引

### 階段 4: 記憶體優化功能驗證

#### 4.1 記憶體壓力測試
- [ ] **同時開啟多個頁面**: 測試並發存取
- [ ] **快速切換頁面**: 測試記憶體清理
- [ ] **長時間運行**: 檢查記憶體洩漏

#### 4.2 StreamingResponseBuilder 驗證
- [ ] **頁面載入速度**: 比較載入時間
- [ ] **記憶體使用**: 透過 `/api/memory/stats` 監控
- [ ] **錯誤處理**: 記憶體不足時的優雅降級

### 階段 5: 錯誤處理與邊界測試

#### 5.1 錯誤情況測試
- [ ] **無效路徑**: 存取不存在的頁面
- [ ] **記憶體不足**: 模擬高記憶體壓力
- [ ] **網路中斷**: 測試網路不穩定情況
- [ ] **並發存取**: 多個用戶同時存取

#### 5.2 邊界值測試
- [ ] **長表單輸入**: 超長 SSID 和密碼
- [ ] **特殊字符**: 測試中文和特殊符號
- [ ] **快速重複提交**: 測試表單防重複提交

## 📊 測試記錄模板

### 測試環境
- **測試日期**: ___________
- **設備 IP**: ___________
- **瀏覽器**: ___________
- **網路環境**: ___________

### 功能測試記錄

| 測試項目 | 狀態 | 備註 |
|---------|------|------|
| 主頁面載入 | ⬜ 通過 ⬜ 失敗 | |
| WiFi 配置頁面 | ⬜ 通過 ⬜ 失敗 | |
| HomeKit 配置頁面 | ⬜ 通過 ⬜ 失敗 | |
| 系統狀態 API | ⬜ 通過 ⬜ 失敗 | |
| 記憶體優化功能 | ⬜ 通過 ⬜ 失敗 | |
| 模擬模式 | ⬜ 通過 ⬜ 失敗 | |
| OTA 功能 | ⬜ 通過 ⬜ 失敗 | |
| 錯誤處理 | ⬜ 通過 ⬜ 失敗 | |

### 效能測試記錄

| 指標 | 目標值 | 實際值 | 狀態 |
|------|--------|--------|------|
| 主頁面載入時間 | < 2秒 | _____ | ⬜ 通過 ⬜ 失敗 |
| 記憶體使用率 | < 60% | _____ | ⬜ 通過 ⬜ 失敗 |
| 併發用戶支援 | ≥ 3 | _____ | ⬜ 通過 ⬜ 失敗 |

## 🐛 已知問題與解決方案

### 常見問題
1. **設備未出現在網路中**
   - 解決：檢查 WiFi 配置，重新啟動設備
   
2. **頁面載入緩慢**
   - 解決：檢查記憶體壓力 API，重新啟動設備

3. **中文字符顯示問題**
   - 解決：確認瀏覽器編碼設為 UTF-8

### 緊急處理步驟
1. **設備無響應**: 重新上傳固件
2. **記憶體溢出**: 重新啟動設備
3. **配置丟失**: 使用出廠重置功能

## ✅ 測試完成檢查清單

測試完成後，請確認：
- [ ] 所有核心功能正常運作
- [ ] 記憶體優化功能有效
- [ ] 錯誤處理機制正常
- [ ] 效能指標符合預期
- [ ] 用戶體驗良好

## 📝 測試報告

測試完成後，請提供：
1. **功能測試結果彙總**
2. **效能測試數據**
3. **發現的問題清單**
4. **改進建議**
5. **整體評估和建議**

---

**注意**: 本測試計劃針對 DaiSpan v3 架構和記憶體優化功能設計。如遇到問題，請參考項目文檔或聯繫開發團隊。